name: Fetch YOLOv8n ONNX

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Download model
        run: |
          rm -f yolov8n.onnx
          curl -L --retry 5 --retry-delay 2 -o yolov8n.onnx \
          https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.onnx

          ls -lh yolov8n.onnx
          SIZE=$(stat -c%s yolov8n.onnx)
          if [ "$SIZE" -lt 1000000 ]; then
            echo "Model too small!"
            exit 1
          fi

      - name: Commit model
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add yolov8n.onnx
          git commit -m "Add YOLOv8n ONNX model"
          git push
